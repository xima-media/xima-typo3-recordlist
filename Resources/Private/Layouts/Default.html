{namespace be=TYPO3\CMS\Backend\ViewHelpers}

<f:be.pageRenderer includeRequireJsModules="{0: 'TYPO3/CMS/Backend/Tooltip', 1:'TYPO3/CMS/Workspaces/Backend', 2: 'TYPO3/CMS/XimaTypo3Recordlist/Recordlist'}" />

<f:render section="Headline" optional="true">
	<h1>{recordCount} Records</h1>
</f:render>


<div id="workspace-settings-form">
	<input type="hidden" name="depth" value="9" /> <input type="hidden" name="languages" value="all" />
	<input type="hidden" name="stage" value="-99" />
</div>

<f:form>

	<div id="searchInputs" class="mb-5">

		<f:form.hidden name="order_field" value="{order_field}" />
		<f:form.hidden name="order_direction" value="{order_direction}" />

		<div class="row mb-3">
			<div class="col-6">
				<f:render partial="Filter/SearchField" arguments="{_all}" />
			</div>
		</div>

		<f:render section="SearchInputs" optional="true" />

	</div>

	<main class="recordlist"
		  data-workspace-switch-action="{workspaceSwitched -> f:format.raw()}"
		  id="workspace-content-wrapper">

		<table class="table table-striped table-hover mb-0">
			<thead>
			<tr>
				<th>Start</th>
				<th>Ende</th>

				<f:render partial="Th"
						  arguments="{label: 'Title', field: 'title', order_field: order_field, order_direction: order_direction}" />

				<th>Status</th>
				<th>Actions</th>
			</tr>
			</thead>
			<tbody>
			<f:render partial="PaginationRow" arguments="{_all}" />
			<f:for each="{records}" as="item">
				<tr data-uid="{item.uid}"
					data-pid="{item.pid}"
					data-t3ver_oid="{item.t3ver_oid}"
					data-t3ver_wsid="1"
					data-stage="{item.t3ver_stage}"
					data-table="{table}"
					data-next-stage="{f:if(condition:'{item.t3ver_stage}===-10', then: '-20', else: '-10')}">
					<td>
						<f:if condition="{item.editable}">
							<f:then>
								<be:link.editRecord uid="{item.uid}"
													table="{table}"
													returnUrl="{f:be.uri(route: moduleName)}">
									<f:format.date format="d.m.Y">{item.start_date}</f:format.date>
								</be:link.editRecord>
							</f:then>
							<f:format.date format="d.m.Y">{item.start_date}</f:format.date>
						</f:if>
					</td>
					<td>
						<f:if condition="{item.end_date}">
							<f:if condition="{item.editable}">
								<f:then>
									<be:link.editRecord uid="{item.uid}"
														table="{table}"
														returnUrl="{f:be.uri(route: moduleName)}">
										<f:format.date format="d.m.Y">{item.end_date}</f:format.date>
									</be:link.editRecord>
								</f:then>
								<f:else>
									<f:format.date format="d.m.Y">{item.end_date}</f:format.date>
								</f:else>
							</f:if>
						</f:if>
					</td>
					<td>
						<core:iconForRecord table="{table}" row="{item}" />
						<f:if condition="{item.editable}">
							<f:then>
								<be:link.editRecord uid="{item.uid}"
													table="{table}"
													returnUrl="{f:be.uri(route: moduleName)}">
									<span class="workspace-state-{item.state}">{item.title}</span>
								</be:link.editRecord>
							</f:then>
							<f:else>
								<span class="workspace-state-{item.state}">{item.title}</span>
							</f:else>
						</f:if>
					</td>
					<td>
						<f:if condition="{item.statusClass}">
							<span class="badge badge-{item.statusClass}">{item.statusText}</span>
						</f:if>
					</td>
					<td>
						<div class="btn-group">
							<f:if condition="{item.editable}">
								<be:link.editRecord uid="{item.uid}"
													table="{table}"
													returnUrl="{f:be.uri(route: moduleName)}"
													class="btn btn-default"
													title="bearbeiten"
													data="{bs-toggle: 'tooltip'}">
									<core:icon identifier="actions-open" size="small" />
								</be:link.editRecord>
							</f:if>
							<f:if condition="{item.t3ver_oid}">
								<a href="#"
								   class="btn btn-default"
								   title="Ã„nderungen anzeigen"
								   data-bs-toggle="tooltip"
								   data-action="changes">
									<core:icon identifier="actions-info" size="small" />
								</a>
							</f:if>
							<f:if condition="{item.t3ver_oid} && ({item.t3ver_stage} === 0 || {isWorkspaceAdmin})">
								<a href="#"
								   class="btn btn-default"
								   title="Arbeitskopie verwerfen"
								   data-bs-toggle="tooltip"
								   data-workspace-action="remove">
									<core:icon identifier="actions-delete" size="small" />
								</a>
							</f:if>
							<f:if condition="{item.url}">
								<a href="{item.url}"
								   target="_blank"
								   class="btn btn-default"
								   title="Auf Webseite ansehen"
								   data-bs-toggle="tooltip">
									<core:icon identifier="actions-view" size="small" />
								</a>
							</f:if>
						</div>
						<f:if condition="{isWorkspaceAdmin}">
							<f:if condition="{item.t3ver_oid}">
								<be:link.editRecord uid="{item.t3ver_oid}"
													table="{table}"
													returnUrl="{f:be.uri(route: moduleName)}"
													class="btn btn-default">
									<core:icon identifier="actions-open" size="small" />
									Original
								</be:link.editRecord>
							</f:if>
						</f:if>
						<f:if condition="{isWorkspaceAdmin} && {item.t3ver_stage} === -10">
							<f:if condition="{item.t3ver_oid}">
								<a href="#" data-action="publish" class="btn btn-success">
									<core:icon identifier="actions-check" size="small" />
									Freigeben
								</a>
							</f:if>
						</f:if>
						<f:if condition="!{isWorkspaceAdmin} && {item.t3ver_stage} === 0">
							<div class="btn-group">
								<f:comment>
									<a href="{item.url}"
									   target="_blank"
									   class="btn btn-outline-success"
									   title="Auf Webseite ansehen"
									   data-bs-toggle="tooltip">
										<core:icon identifier="actions-view" size="small" />
									</a>
								</f:comment>
								<f:if condition="{item.t3ver_oid}">
									<a href="#" data-workspace-action="readyToPublish" class="btn btn-success">
										<core:icon identifier="actions-share" size="small" />
										Freigabe anfordern
									</a>
								</f:if>
							</div>
						</f:if>


					</td>
				</tr>
			</f:for>
			<f:render partial="PaginationRow" arguments="{_all}" />
			</tbody>

		</table>
	</main>
</f:form>
